--=======================================
-- TAKE THE RAW FMLI AND MTBI CSV FILES 
--=======================================

/**
- Problem:
  Raw CSV files contain many columns, making direct import into PostgreSQL
  error-prone and difficult to manage.

- Method:
  Create a staging table by copying the CSV header and assigning all columns
  a TEXT data type, then load the full file into the staging layer.
*/

DROP TABLE IF EXISTS raw.fmli242_stg;

CREATE TABLE raw.fmli241x_stg (
  NEWID text, DIRACC text, DIRACC_ text, AGE_REF text, AGE_REF_ text, AGE2 text, AGE2_ text, AS_COMP1 text, AS_C_MP1 text, AS_COMP2 text, AS_C_MP2 text, AS_COMP3 text, AS_C_MP3 text, AS_COMP4 text, AS_C_MP4 text, AS_COMP5 text, AS_C_MP5 text, BATHRMQ text, BATHRMQ_ text, BEDROOMQ text, BEDR_OMQ text, BLS_URBN text, BUILDING text, BUIL_ING text, CUTENURE text, CUTE_URE text, EARNCOMP text, EARN_OMP text, EDUC_REF text, EDUC0REF text, EDUCA2 text, EDUCA2_ text, FAM_SIZE text, FAM__IZE text, FAM_TYPE text, FAM__YPE text, FGOVRETX text, FGOV_ETX text, FINCBTAX text, FINCBT_X text, FINDRETX text, FIND_ETX text, FINLWT21   text, FJSSDEDX text, FJSS_EDX text, FPRIPENX text, FPRI_ENX text, FRRDEDX text, FRRDEDX_ text, FRRETIRX text, FRRE_IRX text, FSALARYX text, FSAL_RYX text, FSSIX text, FSSIX_ text, HLFBATHQ text, HLFB_THQ text, INC_HRS1 text, INC__RS1 text, INC_HRS2 text, INC__RS2 text, INC_RANK  text, INC__ANK text, INCNONW1 text, INCN_NW1 text, INCNONW2 text, INCN_NW2 text, INCOMEY1 text, INCO_EY1 text, INCOMEY2 text, INCO_EY2 text, INCWEEK1 text, INCW_EK1 text, INCWEEK2 text, INCW_EK2 text, MISCTAXX text, MISC_AXX text, LUMPSUMX text, LUMP_UMX text, MARITAL1 text, MARI_AL1 text, NO_EARNR text, NO_E_RNR text, NONINCMX text, NONI_CMX text, NUM_AUTO text, NUM__UTO text, OCCUCOD1 text, OCCU_OD1 text, OCCUCOD2 text, OCCU_OD2 text, OTHRINCX text, OTHR_NCX text, PERSLT18 text, PERS_T18 text, PERSOT64 text, PERS_T64 text, POPSIZE text, PRINEARN text, PRIN_ARN text, QINTRVMO text, QINTRVYR text, RACE2 text, RACE2_ text, REF_RACE text, REF__ACE text, REGION text, RENTEQVX text, RENT_QVX text, ROOMSQ text, ROOMSQ_ text, SEX_REF text, SEX_REF_ text, SEX2 text, SEX2_ text, SMSASTAT text, ST_HOUS text, ST_HOUS_ text, VEHQ text, VEHQ_ text, WELFAREX text, WELF_REX text, WTREP01    text, WTREP02    text, WTREP03    text, WTREP04    text, WTREP05    text, WTREP06    text, WTREP07    text, WTREP08    text, WTREP09    text, WTREP10    text, WTREP11    text, WTREP12    text, WTREP13    text, WTREP14    text, WTREP15    text, WTREP16    text, WTREP17    text, WTREP18    text, WTREP19    text, WTREP20    text, WTREP21    text, WTREP22    text, WTREP23    text, WTREP24    text, WTREP25    text, WTREP26    text, WTREP27    text, WTREP28    text, WTREP29    text, WTREP30    text, WTREP31    text, WTREP32    text, WTREP33    text, WTREP34    text, WTREP35    text, WTREP36    text, WTREP37    text, WTREP38    text, WTREP39    text, WTREP40    text, WTREP41    text, WTREP42    text, WTREP43    text, WTREP44    text, TOTEXPPQ    text, TOTEXPCQ    text, FOODPQ     text, FOODCQ     text, FDHOMEPQ   text, FDHOMECQ   text, FDAWAYPQ   text, FDAWAYCQ  text, FDXMAPPQ   text, FDXMAPCQ  text, FDMAPPQ   text, FDMAPCQ   text, ALCBEVPQ  text, ALCBEVCQ  text, HOUSPQ     text, HOUSCQ     text, SHELTPQ    text, SHELTCQ    text, OWNDWEPQ   text, OWNDWECQ   text, MRTINTPQ   text, MRTINTCQ   text, PROPTXPQ  text, PROPTXCQ  text, MRPINSPQ   text, MRPINSCQ   text, RENDWEPQ   text, RENDWECQ  text, RNTXRPPQ   text, RNTXRPCQ  text, RNTAPYPQ  text, RNTAPYCQ  text, OTHLODPQ   text, OTHLODCQ   text, UTILPQ    text, UTILCQ    text, NTLGASPQ  text, NTLGASCQ  text, ELCTRCPQ  text, ELCTRCCQ  text, ALLFULPQ  text, ALLFULCQ  text, FULOILPQ  text, FULOILCQ  text, OTHFLSPQ  text, OTHFLSCQ  text, TELEPHPQ  text, TELEPHCQ  text, WATRPSPQ  text, WATRPSCQ  text, HOUSOPPQ   text, HOUSOPCQ   text, DOMSRVPQ   text, DOMSRVCQ   text, DMSXCCPQ   text, DMSXCCCQ   text, BBYDAYPQ   text, BBYDAYCQ   text, OTHHEXPQ   text, OTHHEXCQ  text, HOUSEQPQ   text, HOUSEQCQ   text, TEXTILPQ  text, TEXTILCQ  text, FURNTRPQ   text, FURNTRCQ   text, FLRCVRPQ   text, FLRCVRCQ   text, MAJAPPPQ   text, MAJAPPCQ  text, SMLAPPPQ  text, SMLAPPCQ text, MISCEQPQ   text, MISCEQCQ  text, GIFTAPPQ  text, CHLDAPPQ  text, ADLTAPPQ   text, APPARPQ    text, GIFTAPCQ  text, CHLDAPCQ  text, ADLTAPCQ  text, APPARCQ   text, TRANSPQ     text, TRANSCQ    text, CARTKNPQ    text, CARTKNCQ   text, CARTKUPQ   text, CARTKUCQ   text, OTHVEHPQ   text, OTHVEHCQ  text, GASMOPQ   text, GASMOCQ   text, VEHFINPQ  text, VEHFINCQ  text, MAINRPPQ   text, MAINRPCQ   text, VEHINSPQ  text, VEHINSCQ  text, VRNTLOPQ  text, VRNTLOCQ   text, PUBTRAPQ   text, PUBTRACQ   text, TRNTRPPQ   text, TRNTRPCQ   text, TRNOTHPQ  text, TRNOTHCQ  text, HEALTHPQ   text, HEALTHCQ   text, HLTHINPQ   text, HLTHINCQ   text, MEDSRVPQ   text, MEDSRVCQ   text, PREDRGPQ  text, PREDRGCQ  text, MEDSUPPQ  text, MEDSUPCQ  text, ENTERTPQ   text, ENTERTCQ   text, FEEADMPQ   text, FEEADMCQ   text, TVRDIOPQ  text, TVRDIOCQ  text, OTHEQPPQ   text, OTHEQPCQ   text, PETTOYPQ  text, PETTOYCQ  text, OTHENTPQ   text, OTHENTCQ   text, PERSCAPQ  text, PERSCACQ  text, READPQ    text, READCQ    text, EDUCAPQ    text, EDUCACQ    text, TOBACCPQ  text, TOBACCCQ  text, MISCPQ     text, MISCCQ     text, MISC1PQ    text, MISC1CQ    text, MISC2PQ   text, MISC2CQ   text, CASHCOPQ   text, CASHCOCQ   text, PERINSPQ   text, PERINSCQ   text, LIFINSPQ   text, LIFINSCQ  text, RETPENPQ   text, RETPENCQ   text, HH_CU_Q text, HH_CU_Q_ text, HHID text, HHID_ text, SWIMPOOL text, SWIM_OOL text, APTMENT text, APTMENT_ text, OFSTPARK text, OFST_ARK text, WINDOWAC text, WIND_WAC text, CNTRALAC text, CNTR_LAC text, CHILDAGE text, CHIL_AGE text, STATE text, ERANKH   text, ERANKH_ text, TOTEX4PQ    text, TOTEX4CQ    text, MISCX4PQ   text, MISCX4CQ   text, VEHQL text, VEHQL_ text, NUM_TVAN text, NUM__VAN text, TTOTALP   text, TTOTALC   text, TFOODTOP text, TFOODTOC text, TFOODAWP text, TFOODAWC text, TFOODHOP text, TFOODHOC text, TALCBEVP text, TALCBEVC text, TOTHRLOP  text, TOTHRLOC  text, TTRANPRP  text, TTRANPRC  text, TGASMOTP text, TGASMOTC text, TVRENTLP text, TVRENTLC text, TCARTRKP text, TCARTRKC text, TOTHVHRP text, TOTHVHRC text, TOTHTREP text, TOTHTREC text, TTRNTRIP  text, TTRNTRIC  text, TFAREP    text, TFAREC    text, TAIRFARP  text, TAIRFARC  text, TOTHFARP  text, TOTHFARC  text, TLOCALTP text, TLOCALTC text, TENTRMNP  text, TENTRMNC text, TFEESADP  text, TFEESADC text, TOTHENTP  text, TOTHENTC text, OWNVACP   text, OWNVACC   text, VOTHRLOP  text, VOTHRLOC  text, VMISCHEP text, VMISCHEC text, UTILOWNP text, UTILOWNC text, VFUELOIP text, VFUELOIC text, VOTHRFLP text, VOTHRFLC text, VELECTRP text, VELECTRC text, VNATLGAP text, VNATLGAC text, VWATERPP text, VWATERPC text, MRTPRNOP  text, MRTPRNOC text, UTILRNTP text, UTILRNTC text, RFUELOIP text, RFUELOIC text, ROTHRFLP text, ROTHRFLC text, RELECTRP text, RELECTRC text, RNATLGAP text, RNATLGAC text, RWATERPP text, RWATERPC text, PORCH text, PORCH_ text, ETOTALP    text, ETOTALC    text, ETOTAPX4   text, ETOTACX4   text, EHOUSNGP  text, EHOUSNGC  text, ESHELTRP  text, ESHELTRC  text, EOWNDWLP  text, EOWNDWLC  text, EOTHLODP  text, EOTHLODC  text, EMRTPNOP  text, EMRTPNOC  text, EMRTPNVP text, EMRTPNVC text, ETRANPTP   text, ETRANPTC  text, EVEHPURP   text, EVEHPURC  text, ECARTKNP   text, ECARTKNC  text, ECARTKUP  text, ECARTKUC  text, EOTHVEHP  text, EOTHVEHC text, EENTRMTP  text, EENTRMTC  text, EOTHENTP  text, EOTHENTC  text, ENOMOTRP text, ENOMOTRC text, EMOTRVHP  text, EMOTRVHC  text, EENTMSCP  text, EENTMSCC text, EMISCELP  text, EMISCELC  text, EMISCMTP text, EMISCMTC text, UNISTRQ text, UNISTRQ_ text, WELFREBX text, WELF_EBX text, LUMPSUMB text, LUMP_UMB text, LMPSUMBX text, LMPS_MBX text, OTHRINCB text, OTHR_NCB text, OTRINCBX text, OTRI_CBX text, INCLASS2 text, INCL_SS2 text, CUID   text, INTERI text, HORREF1 text, HORREF1_ text, HORREF2 text, HORREF2_ text, ERANKHM   text, ERANKHM_ text, FGOVRETM text, FGOV_ETM text, FINCBTXM text, FINCB_XM text, FINCBTX1 text, FINCBTX2 text, FINCBTX3 text, FINCBTX4 text, FINCBTX5 text, FINCBTXI text, FJSSDEDM text, FJSS_EDM text, FJSSDED1 text, FJSSDED2 text, FJSSDED3 text, FJSSDED4 text, FJSSDED5 text, FPRIPENM text, FPRI_ENM text, FRRDEDM text, FRRDEDM_ text, FRRETIRM text, FRRE_IRM text, FRRETIR1 text, FRRETIR2 text, FRRETIR3 text, FRRETIR4 text, FRRETIR5 text, FRRETIRI text, FSALARYM text, FSAL_RYM text, FSALARY1 text, FSALARY2 text, FSALARY3 text, FSALARY4 text, FSALARY5 text, FSALARYI text, FSSIXM  text, FSSIXM_ text, FSSIX1 text, FSSIX2 text, FSSIX3 text, FSSIX4 text, FSSIX5 text, FSSIXI text, INC_RNKM  text, INC__NKM text, INC_RNK1  text, INC_RNK2  text, INC_RNK3  text, INC_RNK4  text, INC_RNK5  text, OTHRINCM text, OTHR_NCM text, OTHRINC1 text, OTHRINC2 text, OTHRINC3 text, OTHRINC4 text, OTHRINC5 text, OTHRINCI text, PRINERNM text, PRIN_RNM text, PRINERN1 text, PRINERN2 text, PRINERN3 text, PRINERN4 text, PRINERN5 text, WELFAREM text, WELF_REM text, WELFARE1 text, WELFARE2 text, WELFARE3 text, WELFARE4 text, WELFARE5 text, WELFAREI text, PSU  text, HISP_REF text, HISP2 text, HIGH_EDU text, CREDFINX text, CRED_INX text, CREDITB text, CREDITB_ text, CREDITBX text, CRED_TBX text, CREDITX text, CREDITX_ text, CREDTYRX text, CRED_YRX text, CREDYRB text, CREDYRB_ text, CREDYRBX text, CRED_RBX text, DEFBENRP text, DEFB_NRP text, FMLPYYRX text, FMLP_YRX text, FS_AMTX1 text, FS_AMTX2 text, FS_AMTX3 text, FS_AMTX4 text, FS_AMTX5 text, FS_AMTXI text, FS_AMTXM text, FS_MTHI text, FS_MTHI_ text, FSMPFRMX text, FSMP_RMX text, FSMPFRX1 text, FSMPFRX2 text, FSMPFRX3 text, FSMPFRX4 text, FSMPFRX5 text, FSMPFRXI text, FSMPFRXM text, INTRDVBX text, INTR_VBX text, INTRDVB text, INTRDVB_ text, INTRDVX text, INTRDVX_ text, INTRDVX1 text, INTRDVX2 text, INTRDVX3 text, INTRDVX4 text, INTRDVX5 text, INTRDVXI text, INTRDVXM text, IRAB text, IRAB_ text, IRABX  text, IRABX_ text, IRAX    text, IRAX_ text, IRAYRB text, IRAYRB_ text, IRAYRBX text, IRAYRBX_ text, IRAYRX  text, IRAYRX_ text, JFS_AMT text, JFS_AMT_ text, JFS_AMT1 text, JFS_AMT2 text, JFS_AMT3 text, JFS_AMT4 text, JFS_AMT5 text, JFS_AMTM text, LIQDYRBX text, LIQD_RBX text, LIQUIDBX text, LIQU_DBX text, LIQUDYRB text, LIQU_YRB text, LIQUDYRX text, LIQU_YRX text, LIQUIDB text, LIQUIDB_ text, LIQUIDX text, LIQUIDX_ text, MEALSPAY text, MEAL_PAY text, MLPAYWKX text, MLPA_WKX text, MLPYQWKS text, MLPY_WKS text, NETRENTB text, NETR_NTB text, NETRENTX text, NETR_NTX text, NETRNTBX text, NETR_TBX text, NETRENT1 text, NETRENT2 text, NETRENT3 text, NETRENT4 text, NETRENT5 text, NETRENTI text, NETRENTM text, OTHASTBX text, OTHA_TBX text, OTHASTB text, OTHASTB_ text, OTHASTX text, OTHASTX_ text, OTHFINX text, OTHFINX_ text, OTHLONBX text, OTHL_NBX text, OTHLYRBX text, OTHL_RBX text, OTHLNYRB text, OTHL_YRB text, OTHLNYRX text, OTHL_YRX text, OTHLOAN text, OTHLOAN_ text, OTHLONB text, OTHLONB_ text, OTHLONX text, OTHLONX_ text, OTHREGBX text, OTHR_GBX text, OTHREGB text, OTHREGB_ text, OTHREGX text, OTHREGX_ text, OTHREGX1 text, OTHREGX2 text, OTHREGX3 text, OTHREGX4 text, OTHREGX5 text, OTHREGXI text, OTHREGXM text, OTHSYRBX text, OTHS_RBX text, OTHSTYRB text, OTHS_YRB text, OTHSTYRX text, OTHS_YRX text, RETS_RVB text, RETSURVX text, RETS_RVX text, RETSRVBX text, RETS_VBX text, RETSURV text, RETSURV_ text, RETSURV1 text, RETSURV2 text, RETSURV3 text, RETSURV4 text, RETSURV5 text, RETSURVB text, RETSURVI text, RETSURVM text, ROYESTBX text, ROYE_TBX text, ROYESTB text, ROYESTB_ text, ROYESTX text, ROYESTX_ text, ROYESTX1 text, ROYESTX2 text, ROYESTX3 text, ROYESTX4 text, ROYESTX5 text, ROYESTXI text, ROYESTXM text, STCKYRBX text, STCK_RBX text, STDNTYRB text, STDN_YRB text, STDNTYRX text, STDN_YRX text, STDTYRBX text, STDT_RBX text, STOCKYRB text, STOC_YRB text, STOCKYRX text, STOC_YRX text, STOCKB text, STOCKB_ text, STOCKBX text, STOCKBX_ text, STOCKX  text, STOCKX_ text, STUDFINX text, STUD_INX text, STUDNTBX text, STUD_TBX text, STUDNTB text, STUDNTB_ text, STUDNTX text, STUDNTX_ text, WHLFYRBX text, WHLF_RBX text, WHLFYRB text, WHLFYRB_ text, WHLFYRX text, WHLFYRX_ text, WHOLIFBX text, WHOL_FBX text, WHOLIFB text, WHOLIFB_ text, WHOLIFX text, WHOLIFX_ text, FSMP_RXM text, INTR_VXM text, NETR_NTM text, OTHR_GXM text, RETS_RVM text, ROYE_TXM text, BUSCREEN text, BUSC_EEN text, DIVISION text, REFGEN text, VEHICTAX text, CREDYR text, CREDYR_ text, IRA text, IRAYR text, IRAYR_ text, IRA_ text, LIQUDYR text, LIQUDYR_ text, LIQUID text, LIQUID_ text, OTHLNYR text, OTHLNYR_ text, OTHSTYR text, OTHSTYR_ text, SOLARPNL text, SOLA_PNL text, STDNTYR text, STDNTYR_ text, STOCKYR text, STOCKYR_ text, WHLFYR text, WHLFYR_ text, CBSAPRIN text, URBAN text, CHDTXP text, CHDTXP_ text, CHDTXPH text, CHDTXPH_ text, NUM_VET text
);
/**
  - The fmli241x table contains a different number of columns compared to
  fmli242–fmli251 due to schema differences across survey waves.
*/


CREATE TABLE raw.fmli242_stg (
  NEWID text,DIRACC text,DIRACC_ text,AGE_REF text,AGE_REF_ text,AGE2 text,AGE2_ text,AS_COMP1 text,AS_C_MP1 text,AS_COMP2 text,AS_C_MP2 text,AS_COMP3 text,AS_C_MP3 text,AS_COMP4 text,AS_C_MP4 text,AS_COMP5 text,AS_C_MP5 text,BATHRMQ text,BATHRMQ_ text,BEDROOMQ text,BEDR_OMQ text,BLS_URBN text,BUILDING text,BUIL_ING text,CUTENURE text,CUTE_URE text,EARNCOMP text,EARN_OMP text,EDUC_REF text,EDUC0REF text,EDUCA2 text,EDUCA2_ text,FAM_SIZE text,FAM__IZE text,FAM_TYPE text,FAM__YPE text,FGOVRETX text,FGOV_ETX text,FINCBTAX text,FINCBT_X text,FINDRETX text,FIND_ETX text,FINLWT21 text,FJSSDEDX text,FJSS_EDX text,FPRIPENX text,FPRI_ENX text,FRRDEDX text,FRRDEDX_ text,FRRETIRX text,FRRE_IRX text,FSALARYX text,FSAL_RYX text,FSSIX text,FSSIX_ text,INC_HRS1 text,INC__RS1 text,INC_HRS2 text,INC__RS2 text,INC_RANK text,INC__ANK text,INCNONW1 text,INCN_NW1 text,INCNONW2 text,INCN_NW2 text,INCOMEY1 text,INCO_EY1 text,INCOMEY2 text,INCO_EY2 text,INCWEEK1 text,INCW_EK1 text,INCWEEK2 text,INCW_EK2 text,MISCTAXX text,MISC_AXX text,LUMPSUMX text,LUMP_UMX text,MARITAL1 text,MARI_AL1 text,NO_EARNR text,NO_E_RNR text,NONINCMX text,NONI_CMX text,NUM_AUTO text,NUM__UTO text,OCCUCOD1 text,OCCU_OD1 text,OCCUCOD2 text,OCCU_OD2 text,OTHRINCX text,OTHR_NCX text,PERSLT18 text,PERS_T18 text,PERSOT64 text,PERS_T64 text,POPSIZE text,PRINEARN text,PRIN_ARN text,QINTRVMO text,QINTRVYR text,RACE2 text,RACE2_ text,REF_RACE text,REF__ACE text,REGION text,RENTEQVX text,RENT_QVX text,SEX_REF text,SEX_REF_ text,SEX2 text,SEX2_ text,SMSASTAT text,ST_HOUS text,ST_HOUS_ text,VEHQ text,VEHQ_ text,WELFAREX text,WELF_REX text,WTREP01 text,WTREP02 text,WTREP03 text,WTREP04 text,WTREP05 text,WTREP06 text,WTREP07 text,WTREP08 text,WTREP09 text,WTREP10 text,WTREP11 text,WTREP12 text,WTREP13 text,WTREP14 text,WTREP15 text,WTREP16 text,WTREP17 text,WTREP18 text,WTREP19 text,WTREP20 text,WTREP21 text,WTREP22 text,WTREP23 text,WTREP24 text,WTREP25 text,WTREP26 text,WTREP27 text,WTREP28 text,WTREP29 text,WTREP30 text,WTREP31 text,WTREP32 text,WTREP33 text,WTREP34 text,WTREP35 text,WTREP36 text,WTREP37 text,WTREP38 text,WTREP39 text,WTREP40 text,WTREP41 text,WTREP42 text,WTREP43 text,WTREP44 text,TOTEXPPQ text,TOTEXPCQ text,FDHOMEPQ text,FDHOMECQ text,FDAWAYPQ text,FDAWAYCQ text,FDXMAPPQ text,FDXMAPCQ text,FDMAPPQ text,FDMAPCQ text,ALCBEVPQ text,ALCBEVCQ text,HOUSPQ text,HOUSCQ text,SHELTPQ text,SHELTCQ text,OWNDWEPQ text,OWNDWECQ text,MRTINTPQ text,MRTINTCQ text,PROPTXPQ text,PROPTXCQ text,MRPINSPQ text,MRPINSCQ text,RENDWEPQ text,RENDWECQ text,RNTXRPPQ text,RNTXRPCQ text,RNTAPYPQ text,RNTAPYCQ text,OTHLODPQ text,OTHLODCQ text,UTILPQ text,UTILCQ text,NTLGASPQ text,NTLGASCQ text,ELCTRCPQ text,ELCTRCCQ text,ALLFULPQ text,ALLFULCQ text,FULOILPQ text,FULOILCQ text,OTHFLSPQ text,OTHFLSCQ text,TELEPHPQ text,TELEPHCQ text,WATRPSPQ text,WATRPSCQ text,HOUSOPPQ text,HOUSOPCQ text,DOMSRVPQ text,DOMSRVCQ text,DMSXCCPQ text,DMSXCCCQ text,BBYDAYPQ text,BBYDAYCQ text,OTHHEXPQ text,OTHHEXCQ text,HOUSEQPQ text,HOUSEQCQ text,TEXTILPQ text,TEXTILCQ text,FURNTRPQ text,FURNTRCQ text,FLRCVRPQ text,FLRCVRCQ text,MAJAPPPQ text,MAJAPPCQ text,SMLAPPPQ text,SMLAPPCQ text,MISCEQPQ text,MISCEQCQ text,GIFTAPPQ text,CHLDAPPQ text,ADLTAPPQ text,APPARPQ text,GIFTAPCQ text,CHLDAPCQ text,ADLTAPCQ text,APPARCQ text,TRANSPQ text,TRANSCQ text,CARTKNPQ text,CARTKNCQ text,CARTKUPQ text,CARTKUCQ text,OTHVEHPQ text,OTHVEHCQ text,GASMOPQ text,GASMOCQ text,VEHFINPQ text,VEHFINCQ text,MAINRPPQ text,MAINRPCQ text,VEHINSPQ text,VEHINSCQ text,VRNTLOPQ text,VRNTLOCQ text,PUBTRAPQ text,PUBTRACQ text,TRNTRPPQ text,TRNTRPCQ text,TRNOTHPQ text,TRNOTHCQ text,HEALTHPQ text,HEALTHCQ text,HLTHINPQ text,HLTHINCQ text,MEDSRVPQ text,MEDSRVCQ text,PREDRGPQ text,PREDRGCQ text,MEDSUPPQ text,MEDSUPCQ text,ENTERTPQ text,ENTERTCQ text,FEEADMPQ text,FEEADMCQ text,TVRDIOPQ text,TVRDIOCQ text,OTHEQPPQ text,OTHEQPCQ text,PETTOYPQ text,PETTOYCQ text,OTHENTPQ text,OTHENTCQ text,PERSCAPQ text,PERSCACQ text,READPQ text,READCQ text,EDUCAPQ text,EDUCACQ text,TOBACCPQ text,TOBACCCQ text,MISCPQ text,MISCCQ text,MISC1PQ text,MISC1CQ text,MISC2PQ text,MISC2CQ text,CASHCOPQ text,CASHCOCQ text,PERINSPQ text,PERINSCQ text,LIFINSPQ text,LIFINSCQ text,RETPENPQ text,RETPENCQ text,HH_CU_Q text,HH_CU_Q_ text,HHID text,HHID_ text,CHILDAGE text,CHIL_AGE text,STATE text,ERANKH text,ERANKH_ text,TOTEX4PQ text,TOTEX4CQ text,MISCX4PQ text,MISCX4CQ text,VEHQL text,VEHQL_ text,NUM_TVAN text,NUM__VAN text,TTOTALP text,TTOTALC text,TFOODTOP text,TFOODTOC text,TFOODAWP text,TFOODAWC text,TFOODHOP text,TFOODHOC text,TALCBEVP text,TALCBEVC text,TOTHRLOP text,TOTHRLOC text,TTRANPRP text,TTRANPRC text,TGASMOTP text,TGASMOTC text,TVRENTLP text,TVRENTLC text,TCARTRKP text,TCARTRKC text,TOTHVHRP text,TOTHVHRC text,TOTHTREP text,TOTHTREC text,TTRNTRIP text,TTRNTRIC text,TFAREP text,TFAREC text,TAIRFARP text,TAIRFARC text,TOTHFARP text,TOTHFARC text,TLOCALTP text,TLOCALTC text,TENTRMNP text,TENTRMNC text,TFEESADP text,TFEESADC text,TOTHENTP text,TOTHENTC text,OWNVACP text,OWNVACC text,VOTHRLOP text,VOTHRLOC text,VMISCHEP text,VMISCHEC text,UTILOWNP text,UTILOWNC text,VFUELOIP text,VFUELOIC text,VOTHRFLP text,VOTHRFLC text,VELECTRP text,VELECTRC text,VNATLGAP text,VNATLGAC text,VWATERPP text,VWATERPC text,MRTPRNOP text,MRTPRNOC text,UTILRNTP text,UTILRNTC text,RFUELOIP text,RFUELOIC text,ROTHRFLP text,ROTHRFLC text,RELECTRP text,RELECTRC text,RNATLGAP text,RNATLGAC text,RWATERPP text,RWATERPC text,ETOTALP text,ETOTALC text,ETOTAPX4 text,ETOTACX4 text,EHOUSNGP text,EHOUSNGC text,ESHELTRP text,ESHELTRC text,EOWNDWLP text,EOWNDWLC text,EOTHLODP text,EOTHLODC text,EMRTPNOP text,EMRTPNOC text,EMRTPNVP text,EMRTPNVC text,ETRANPTP text,ETRANPTC text,EVEHPURP text,EVEHPURC text,ECARTKNP text,ECARTKNC text,ECARTKUP text,ECARTKUC text,EOTHVEHP text,EOTHVEHC text,EENTRMTP text,EENTRMTC text,EOTHENTP text,EOTHENTC text,EENTMSCP text,EENTMSCC text,EMISCELP text,EMISCELC text,EMISCMTP text,EMISCMTC text,UNISTRQ text,UNISTRQ_ text,ERECVEHC text,ERECVEHP text,WELFREBX text,WELF_EBX text,LUMPSUMB text,LUMP_UMB text,LMPSUMBX text,LMPS_MBX text,OTHRINCB text,OTHR_NCB text,OTRINCBX text,OTRI_CBX text,INCLASS2 text,INCL_SS2 text,CUID text,INTERI text,HORREF1 text,HORREF1_ text,HORREF2 text,HORREF2_ text,ERANKHM text,ERANKHM_ text,FGOVRETM text,FGOV_ETM text,FINCBTXM text,FINCB_XM text,FINCBTX1 text,FINCBTX2 text,FINCBTX3 text,FINCBTX4 text,FINCBTX5 text,FINCBTXI text,FJSSDEDM text,FJSS_EDM text,FJSSDED1 text,FJSSDED2 text,FJSSDED3 text,FJSSDED4 text,FJSSDED5 text,FPRIPENM text,FPRI_ENM text,FRRDEDM text,FRRDEDM_ text,FRRETIRM text,FRRE_IRM text,FRRETIR1 text,FRRETIR2 text,FRRETIR3 text,FRRETIR4 text,FRRETIR5 text,FRRETIRI text,FSALARYM text,FSAL_RYM text,FSALARY1 text,FSALARY2 text,FSALARY3 text,FSALARY4 text,FSALARY5 text,FSALARYI text,FSSIXM text,FSSIXM_ text,FSSIX1 text,FSSIX2 text,FSSIX3 text,FSSIX4 text,FSSIX5 text,FSSIXI text,INC_RNKM text,INC__NKM text,INC_RNK1 text,INC_RNK2 text,INC_RNK3 text,INC_RNK4 text,INC_RNK5 text,OTHRINCM text,OTHR_NCM text,OTHRINC1 text,OTHRINC2 text,OTHRINC3 text,OTHRINC4 text,OTHRINC5 text,OTHRINCI text,PRINERNM text,PRIN_RNM text,PRINERN1 text,PRINERN2 text,PRINERN3 text,PRINERN4 text,PRINERN5 text,WELFAREM text,WELF_REM text,WELFARE1 text,WELFARE2 text,WELFARE3 text,WELFARE4 text,WELFARE5 text,WELFAREI text,PSU text,HISP_REF text,HISP2 text,HIGH_EDU text,CREDFINX text,CRED_INX text,CREDITB text,CREDITB_ text,CREDITBX text,CRED_TBX text,CREDITX text,CREDITX_ text,CREDTYRX text,CRED_YRX text,CREDYRB text,CREDYRB_ text,CREDYRBX text,CRED_RBX text,DEFBENRP text,DEFB_NRP text,FMLPYYRX text,FMLP_YRX text,FS_AMTX1 text,FS_AMTX2 text,FS_AMTX3 text,FS_AMTX4 text,FS_AMTX5 text,FS_AMTXI text,FS_AMTXM text,FS_MTHI text,FS_MTHI_ text,FSMPFRMX text,FSMP_RMX text,FSMPFRX1 text,FSMPFRX2 text,FSMPFRX3 text,FSMPFRX4 text,FSMPFRX5 text,FSMPFRXI text,FSMPFRXM text,INTRDVBX text,INTR_VBX text,INTRDVB text,INTRDVB_ text,INTRDVX text,INTRDVX_ text,INTRDVX1 text,INTRDVX2 text,INTRDVX3 text,INTRDVX4 text,INTRDVX5 text,INTRDVXI text,INTRDVXM text,IRAB text,IRAB_ text,IRABX text,IRABX_ text,IRAX text,IRAX_ text,IRAYRB text,IRAYRB_ text,IRAYRBX text,IRAYRBX_ text,IRAYRX text,IRAYRX_ text,JFS_AMT text,JFS_AMT_ text,JFS_AMT1 text,JFS_AMT2 text,JFS_AMT3 text,JFS_AMT4 text,JFS_AMT5 text,JFS_AMTM text,LIQDYRBX text,LIQD_RBX text,LIQUIDBX text,LIQU_DBX text,LIQUDYRB text,LIQU_YRB text,LIQUDYRX text,LIQU_YRX text,LIQUIDB text,LIQUIDB_ text,LIQUIDX text,LIQUIDX_ text,MEALSPAY text,MEAL_PAY text,MLPAYWKX text,MLPA_WKX text,MLPYQWKS text,MLPY_WKS text,NETRENTB text,NETR_NTB text,NETRENTX text,NETR_NTX text,NETRNTBX text,NETR_TBX text,NETRENT1 text,NETRENT2 text,NETRENT3 text,NETRENT4 text,NETRENT5 text,NETRENTI text,NETRENTM text,OTHASTBX text,OTHA_TBX text,OTHASTB text,OTHASTB_ text,OTHASTX text,OTHASTX_ text,OTHFINX text,OTHFINX_ text,OTHLONBX text,OTHL_NBX text,OTHLYRBX text,OTHL_RBX text,OTHLNYRB text,OTHL_YRB text,OTHLNYRX text,OTHL_YRX text,OTHLOAN text,OTHLOAN_ text,OTHLONB text,OTHLONB_ text,OTHLONX text,OTHLONX_ text,OTHREGBX text,OTHR_GBX text,OTHREGB text,OTHREGB_ text,OTHREGX text,OTHREGX_ text,OTHREGX1 text,OTHREGX2 text,OTHREGX3 text,OTHREGX4 text,OTHREGX5 text,OTHREGXI text,OTHREGXM text,OTHSYRBX text,OTHS_RBX text,OTHSTYRB text,OTHS_YRB text,OTHSTYRX text,OTHS_YRX text,RETS_RVB text,RETSURVX text,RETS_RVX text,RETSRVBX text,RETS_VBX text,RETSURV text,RETSURV_ text,RETSURV1 text,RETSURV2 text,RETSURV3 text,RETSURV4 text,RETSURV5 text,RETSURVB text,RETSURVI text,RETSURVM text,ROYESTBX text,ROYE_TBX text,ROYESTB text,ROYESTB_ text,ROYESTX text,ROYESTX_ text,ROYESTX1 text,ROYESTX2 text,ROYESTX3 text,ROYESTX4 text,ROYESTX5 text,ROYESTXI text,ROYESTXM text,STCKYRBX text,STCK_RBX text,STDNTYRB text,STDN_YRB text,STDNTYRX text,STDN_YRX text,STDTYRBX text,STDT_RBX text,STOCKYRB text,STOC_YRB text,STOCKYRX text,STOC_YRX text,STOCKB text,STOCKB_ text,STOCKBX text,STOCKBX_ text,STOCKX text,STOCKX_ text,STUDFINX text,STUD_INX text,STUDNTBX text,STUD_TBX text,STUDNTB text,STUDNTB_ text,STUDNTX text,STUDNTX_ text,WHLFYRBX text,WHLF_RBX text,WHLFYRB text,WHLFYRB_ text,WHLFYRX text,WHLFYRX_ text,WHOLIFBX text,WHOL_FBX text,WHOLIFB text,WHOLIFB_ text,WHOLIFX text,WHOLIFX_ text,FSMP_RXM text,INTR_VXM text,NETR_NTM text,OTHR_GXM text,RETS_RVM text,ROYE_TXM text,BUSCREEN text,BUSC_EEN text,DIVISION text,REFGEN text,VEHICTAX text,CREDYR text,CREDYR_ text,IRA text,IRAYR text,IRAYR_ text,IRA_ text,LIQUDYR text,LIQUDYR_ text,LIQUID text,LIQUID_ text,OTHLNYR text,OTHLNYR_ text,OTHSTYR text,OTHSTYR_ text,STDNTYR text,STDNTYR_ text,STOCKYR text,STOCKYR_ text,WHLFYR text,WHLFYR_ text,CBSAPRIN text,URBAN text,NUM_VET text,GROCERPQ text,GROCERCQ text
);
-- The same staging and import steps are repeated for fmli242–fmli251.

DROP TABLE IF EXISTS raw.mtbi241x_stg;

CREATE TABLE raw.mtbi241x_stg(
    NEWID TEXT,
    SEQNO TEXT,
    ALCNO TEXT,
    EXPNAME TEXT,
    COST_ TEXT,
    REF_MO TEXT,
    REF_YR TEXT,
    RTYPE TEXT,
    GIFT TEXT,
    UCCSEQ TEXT,
    UCC TEXT,
    COST TEXT,
    PUBFLAG TEXT
);
-- Note: The same staging and import steps are repeated for fmli242–fmli251.

--========================================
-- CREAT RAW TABLES WITH ONLY USED COLUMN
--========================================

/**
- Problem:
  The raw dataset contains a large number of variables, many of which are not
  relevant for the Engel’s Law analysis and may add unnecessary complexity.

- Method:
  Select and retain only the variables required for analysis, including household
  identifiers, time indicators, income, and expenditure measures.
*/

CREATE TABLE raw.fmli241x(
    NEWID BIGINT,
    QINTRVYR INT,
    QINTRVMO INT,
    FINCBTAX NUMERIC -- popular for income, money
);

CREATE TABLE raw.mtbi241x(
    NEWID BIGINT,
    REF_YR INT,
    REF_MO INT,
    UCC INT,
    COST NUMERIC
);
-- Note: The same staging and import steps are repeated for fmli242–fmli251.


--==========================================
-- INSERT VALUE INTO THE TABLE AND CAST TYPE
--==========================================

/**
- Problem: 
  Value may be an empty String('')
- Method: 
  Use NULLIF(x,y) to cast it NULL if x = y
  to make sure no lost data
*/

INSERT INTO raw.fmli241x (NEWID, QINTRVYR, QINTRVMO, FINCBTAX)
SELECT 
  NULLIF("newid",'')::BIGINT,
  NULLIF("qintrvyr",'')::INT,
  NULLIF("qintrvmo",'')::INT,
  NULLIF("fincbtax",'')::NUMERIC
FROM raw.fmli241x_stg;

INSERT INTO raw.mtbi241x (NEWID, REF_YR, REF_MO, UCC, COST)
SELECT
  NULLIF("newid",'')::BIGINT,
  NULLIF("ref_yr",'')::INT,
  NULLIF("ref_mo",'')::INT,
  NULLIF("ucc",'')::INT,
  NULLIF("cost",'')::NUMERIC
FROM raw.mtbi241x_stg;
-- Note: The same staging and import steps are repeated for fmli242–fmli251.
